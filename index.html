<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kluci Rozlučka</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #1a1a1a;
      color: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #333;
      padding: 1rem;
      text-align: center;
    }
    h1 {
      margin: 0;
    }
    #scoreboard {
      margin: 1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #555;
      padding: 0.5rem;
      text-align: left;
    }
    #tasks {
      margin: 1rem;
    }
    .task {
      background-color: #262626;
      padding: 1rem;
      margin-bottom: 0.5rem;
      border-radius: 8px;
    }
    .task h3 {
      margin-top: 0;
    }
    .complete-btn {
      background-color: #e63946;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
    }
    .complete-btn:hover {
      background-color: #d62828;
    }
    .message {
      margin-top: 0.5rem;
      font-style: italic;
      color: #a8dadc;
    }
  </style>
</head>
<body>
  <header>
    <h1>Rozlučka pro kluky</h1>
  </header>
  <section id="scoreboard">
    <h2>Žebříček</h2>
    <table>
      <thead>
        <tr>
          <th>Jméno</th>
          <th>Body</th>
        </tr>
      </thead>
      <tbody id="scoreRows">
        <!-- Score rows will be inserted here -->
      </tbody>
    </table>
  </section>
  <section id="tasks">
    <h2>Úkoly</h2>
    <!-- Tasks will be inserted here -->
  </section>

  <!-- Firebase SDKs (replace with your versions as needed) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <script>
    // TODO: Replace the following with your app's Firebase project configuration.
    // See: https://support.google.com/firebase/answer/7015592
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Predefined list of players (edit as needed)
    const players = ["Tom", "Mira", "Martin", "Lukas", "Vlada"];

    // Initialize scores in memory
    const scores = {};
    players.forEach(name => scores[name] = 0);

    // Function to render scoreboard
    function renderScoreboard() {
      const tbody = document.getElementById('scoreRows');
      tbody.innerHTML = '';
      players.forEach(name => {
        const tr = document.createElement('tr');
        const nameTd = document.createElement('td');
        nameTd.textContent = name;
        const scoreTd = document.createElement('td');
        scoreTd.textContent = scores[name];
        tr.appendChild(nameTd);
        tr.appendChild(scoreTd);
        tbody.appendChild(tr);
      });
    }

    // Fetch tasks and messages
    let tasks = [];
    let messages = [];

    async function loadData() {
      const tasksResponse = await fetch('tasks.json');
      tasks = await tasksResponse.json();
      const messagesResponse = await fetch('messages.json');
      messages = await messagesResponse.json();
      renderTasks();
      renderScoreboard();
    }

    function getRandomMessage() {
      const index = Math.floor(Math.random() * messages.length);
      return messages[index];
    }

    function renderTasks() {
      const container = document.getElementById('tasks');
      tasks.forEach(task => {
        const div = document.createElement('div');
        div.className = 'task';
        const title = document.createElement('h3');
        title.textContent = `${task.id}. ${task.text} (${task.points} bodů)`;
        div.appendChild(title);
        if (task.subtask) {
          const sub = document.createElement('p');
          sub.textContent = `Podúkol: ${task.subtask}`;
          div.appendChild(sub);
        }
        const btn = document.createElement('button');
        btn.className = 'complete-btn';
        btn.textContent = 'Splněno';
        btn.onclick = () => completeTask(task);
        div.appendChild(btn);
        const msg = document.createElement('p');
        msg.className = 'message';
        div.appendChild(msg);
        container.appendChild(div);
      });
    }

    function completeTask(task) {
      const player = prompt(`Kdo úkol splnil? (${players.join(', ')})`).trim();
      if (!players.includes(player)) {
        alert('Neplatné jméno hráče.');
        return;
      }
      // Update local score
      scores[player] += task.points;
      renderScoreboard();

      // Show random encouraging message for this task
      const msgEl = event.target.parentElement.querySelector('.message');
      msgEl.textContent = getRandomMessage();

      // Save completion to Firebase (optional)
      const completionsRef = database.ref('completions');
      const newCompletionRef = completionsRef.push();
      newCompletionRef.set({
        player: player,
        taskId: task.id,
        points: task.points,
        timestamp: Date.now()
      });
    }

    window.onload = loadData;
  </script>
</body>
</html>
